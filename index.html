<script>
let data = JSON.parse(localStorage.getItem("pasien") || "[]");
const tabel = document.getElementById("tabel");

function render() {
  tabel.innerHTML = "";
  data.forEach((p, i) => {
    const nama = p.nama || "Belum diisi";
    const umur = p.umur || "-";
    const dx = p.dx || "-";
    const tindakan = p.tindakan || "-";
    const status = p.status || "Observasi";
    const tanggal = p.tanggal || "-";

    tabel.innerHTML += `<tr>
      <td>${nama}</td>
      <td>${umur}</td>
      <td>${dx}</td>
      <td>${tindakan}</td>
      <td>${status}</td>
      <td>${tanggal}</td>
      <td><button class="hapus" onclick="hapus(${i})">Hapus</button></td>
    </tr>`;
  });
}

function hapus(i) {
  if (confirm("Yakin hapus pasien ini?")) {
    data.splice(i, 1);
    localStorage.setItem("pasien", JSON.stringify(data));
    render();
  }
}

render();

document.getElementById("form").onsubmit = e => {
  e.preventDefault();

  const nama = document.getElementById("nama").value.trim() || "Belum diisi";
  const umur = document.getElementById("umur").value || "-";
  const dx = document.getElementById("dx").value.trim() || "-";
  const tindakan = document.getElementById("tindakan").value.trim() || "-";
  const status = document.getElementById("status").value || "Observasi";

  // fallback format tanggal kalau browser lama tidak support dateStyle
  const now = new Date();
  let tanggal;
  try {
    tanggal = now.toLocaleString("id-ID", { dateStyle: "short", timeStyle: "short" });
  } catch {
    // fallback manual
    tanggal = now.getDate() + "/" + (now.getMonth()+1) + "/" + now.getFullYear() + " " +
              now.getHours() + ":" + now.getMinutes();
  }

  data.push({ nama, umur, dx, tindakan, status, tanggal });

  localStorage.setItem("pasien", JSON.stringify(data));
  render();
  e.target.reset();
};
</script>
